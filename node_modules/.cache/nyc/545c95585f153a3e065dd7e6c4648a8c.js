"use strict";var cov_j3dzxm5iw=function(){var path="/Users/andela/Documents/store-manager/app/controller/user.js",hash="ba6df5ec3427c1d8f103ed0a990a7bd6c2d065f1",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/andela/Documents/store-manager/app/controller/user.js",statementMap:{"0":{start:{line:3,column:29},end:{line:3,column:84}},"1":{start:{line:5,column:0},end:{line:7,column:3}},"2":{start:{line:8,column:0},end:{line:8,column:25}},"3":{start:{line:10,column:23},end:{line:10,column:95}},"4":{start:{line:12,column:20},end:{line:12,column:89}},"5":{start:{line:14,column:20},end:{line:14,column:67}},"6":{start:{line:16,column:13},end:{line:16,column:61}},"7":{start:{line:24,column:0},end:{line:152,column:3}},"8":{start:{line:26,column:4},end:{line:26,column:51}},"9":{start:{line:29,column:2},end:{line:150,column:6}},"10":{start:{line:39,column:6},end:{line:41,column:9}},"11":{start:{line:53,column:22},end:{line:53,column:30}},"12":{start:{line:54,column:18},end:{line:54,column:33}},"13":{start:{line:55,column:22},end:{line:55,column:41}},"14":{start:{line:56,column:21},end:{line:56,column:39}},"15":{start:{line:57,column:25},end:{line:57,column:47}},"16":{start:{line:58,column:24},end:{line:58,column:45}},"17":{start:{line:59,column:17},end:{line:59,column:31}},"18":{start:{line:60,column:19},end:{line:60,column:35}},"19":{start:{line:61,column:21},end:{line:61,column:39}},"20":{start:{line:62,column:27},end:{line:62,column:51}},"21":{start:{line:63,column:15},end:{line:63,column:40}},"22":{start:{line:64,column:20},end:{line:64,column:36}},"23":{start:{line:65,column:22},end:{line:65,column:32}},"24":{start:{line:66,column:20},end:{line:79,column:7}},"25":{start:{line:81,column:6},end:{line:81,column:35}},"26":{start:{line:83,column:6},end:{line:86,column:9}},"27":{start:{line:98,column:23},end:{line:98,column:31}},"28":{start:{line:99,column:20},end:{line:99,column:38}},"29":{start:{line:100,column:21},end:{line:100,column:40}},"30":{start:{line:102,column:23},end:{line:104,column:8}},"31":{start:{line:103,column:8},end:{line:103,column:70}},"32":{start:{line:106,column:6},end:{line:117,column:7}},"33":{start:{line:107,column:20},end:{line:111,column:10}},"34":{start:{line:113,column:8},end:{line:116,column:11}},"35":{start:{line:119,column:6},end:{line:121,column:9}},"36":{start:{line:133,column:25},end:{line:133,column:46}},"37":{start:{line:135,column:22},end:{line:137,column:8}},"38":{start:{line:136,column:8},end:{line:136,column:50}},"39":{start:{line:139,column:6},end:{line:144,column:7}},"40":{start:{line:140,column:8},end:{line:143,column:11}},"41":{start:{line:146,column:6},end:{line:148,column:9}},"42":{start:{line:151,column:2},end:{line:151,column:19}},"43":{start:{line:154,column:15},end:{line:154,column:24}},"44":{start:{line:155,column:0},end:{line:155,column:27}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:24,column:0},end:{line:24,column:1}},loc:{start:{line:24,column:12},end:{line:152,column:1}},line:24},"1":{name:"UsersCtrl",decl:{start:{line:25,column:11},end:{line:25,column:20}},loc:{start:{line:25,column:23},end:{line:27,column:3}},line:25},"2":{name:"getAllUser",decl:{start:{line:38,column:20},end:{line:38,column:30}},loc:{start:{line:38,column:41},end:{line:42,column:5}},line:38},"3":{name:"createUser",decl:{start:{line:52,column:20},end:{line:52,column:30}},loc:{start:{line:52,column:41},end:{line:87,column:5}},line:52},"4":{name:"userLogin",decl:{start:{line:97,column:20},end:{line:97,column:29}},loc:{start:{line:97,column:40},end:{line:122,column:5}},line:97},"5":{name:"(anonymous_5)",decl:{start:{line:102,column:43},end:{line:102,column:44}},loc:{start:{line:102,column:59},end:{line:104,column:7}},line:102},"6":{name:"resetPassword",decl:{start:{line:132,column:20},end:{line:132,column:33}},loc:{start:{line:132,column:44},end:{line:149,column:5}},line:132},"7":{name:"(anonymous_7)",decl:{start:{line:135,column:42},end:{line:135,column:43}},loc:{start:{line:135,column:58},end:{line:137,column:7}},line:135}},branchMap:{"0":{loc:{start:{line:103,column:15},end:{line:103,column:69}},type:"binary-expr",locations:[{start:{line:103,column:15},end:{line:103,column:39}},{start:{line:103,column:43},end:{line:103,column:69}}],line:103},"1":{loc:{start:{line:106,column:6},end:{line:117,column:7}},type:"if",locations:[{start:{line:106,column:6},end:{line:117,column:7}},{start:{line:106,column:6},end:{line:117,column:7}}],line:106},"2":{loc:{start:{line:139,column:6},end:{line:144,column:7}},type:"if",locations:[{start:{line:139,column:6},end:{line:144,column:7}},{start:{line:139,column:6},end:{line:144,column:7}}],line:139}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var _interopRequireDefault=(cov_j3dzxm5iw.s[0]++,require("@babel/runtime/helpers/interopRequireDefault"));cov_j3dzxm5iw.s[1]++;Object.defineProperty(exports,"__esModule",{value:true});cov_j3dzxm5iw.s[2]++;exports.default=void 0;var _classCallCheck2=(cov_j3dzxm5iw.s[3]++,_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")));var _createClass2=(cov_j3dzxm5iw.s[4]++,_interopRequireDefault(require("@babel/runtime/helpers/createClass")));var _jsonwebtoken=(cov_j3dzxm5iw.s[5]++,_interopRequireDefault(require("jsonwebtoken")));var _users=(cov_j3dzxm5iw.s[6]++,_interopRequireDefault(require("../data/users")));/**
 * @class UsersCtrl
 * @classdesc manages Users
 */var UsersCtrl=(/*#__PURE__*/cov_j3dzxm5iw.s[7]++,function(){cov_j3dzxm5iw.f[0]++;function UsersCtrl(){cov_j3dzxm5iw.f[1]++;cov_j3dzxm5iw.s[8]++;(0,_classCallCheck2.default)(this,UsersCtrl);}cov_j3dzxm5iw.s[9]++;(0,_createClass2.default)(UsersCtrl,null,[{key:"getAllUser",/**
     * @description - retrieves all users
     * @param {*} req - Request object
     * @param {*} res - response object
     * @returns {users} returns Users
     */value:function getAllUser(req,res){cov_j3dzxm5iw.f[2]++;cov_j3dzxm5iw.s[10]++;return res.status(200).json({UsersData:_users.default});}/**
     * @description Create a new user either as an Admin or a sale attendant
     * @param {*} req - request object
     * @param {*} res - response object
     * @returns {null} - no returns
     */},{key:"createUser",value:function createUser(req,res){cov_j3dzxm5iw.f[3]++;var _req$body=(cov_j3dzxm5iw.s[11]++,req.body),title=(cov_j3dzxm5iw.s[12]++,_req$body.title),firstname=(cov_j3dzxm5iw.s[13]++,_req$body.firstname),lastname=(cov_j3dzxm5iw.s[14]++,_req$body.lastname),emailAddress=(cov_j3dzxm5iw.s[15]++,_req$body.emailAddress),phoneNumber=(cov_j3dzxm5iw.s[16]++,_req$body.phoneNumber),role=(cov_j3dzxm5iw.s[17]++,_req$body.role),gender=(cov_j3dzxm5iw.s[18]++,_req$body.gender),passport=(cov_j3dzxm5iw.s[19]++,_req$body.passport),contactAddress=(cov_j3dzxm5iw.s[20]++,_req$body.contactAddress);var id=(cov_j3dzxm5iw.s[21]++,_users.default.length+1);var staffId=(cov_j3dzxm5iw.s[22]++,"SM0".concat(id));var createdAt=(cov_j3dzxm5iw.s[23]++,new Date());var newUser=(cov_j3dzxm5iw.s[24]++,{id:id,title:title,staffId:staffId,firstname:firstname,lastname:lastname,emailAddress:emailAddress,phoneNumber:phoneNumber,role:role,gender:gender,passport:passport,contactAddress:contactAddress,createdAt:createdAt});cov_j3dzxm5iw.s[25]++;_users.default.push(newUser);cov_j3dzxm5iw.s[26]++;res.status(201).json({msg:'New user successfully created',data:newUser});}/**
     * @description - Accept two field to login a user
     * @param {*} req - request object
     * @param {*} res - response object
     * @returns {null} - no return
     */},{key:"userLogin",value:function userLogin(req,res){cov_j3dzxm5iw.f[4]++;var _req$body2=(cov_j3dzxm5iw.s[27]++,req.body),staffId=(cov_j3dzxm5iw.s[28]++,_req$body2.staffId),password=(cov_j3dzxm5iw.s[29]++,_req$body2.password);var userDetail=(cov_j3dzxm5iw.s[30]++,_users.default.find(function(user){cov_j3dzxm5iw.f[5]++;cov_j3dzxm5iw.s[31]++;return(cov_j3dzxm5iw.b[0][0]++,user.staffId===staffId)&&(cov_j3dzxm5iw.b[0][1]++,user.password===password);}));cov_j3dzxm5iw.s[32]++;if(userDetail){cov_j3dzxm5iw.b[1][0]++;var token=(cov_j3dzxm5iw.s[33]++,_jsonwebtoken.default.sign({staffId:"".concat(userDetail.role)},process.env.SECRET,{expiresIn:'1h'}));cov_j3dzxm5iw.s[34]++;return res.status(200).json({msg:'Login successful',token:token});}else{cov_j3dzxm5iw.b[1][1]++;}cov_j3dzxm5iw.s[35]++;res.status(404).json({msg:'Login failed'});}/**
     * @description - Reset user password
     * @param {*} req - request object
     * @param {*} res  - response object
     * @returns {null} - No returns
     */},{key:"resetPassword",value:function resetPassword(req,res){cov_j3dzxm5iw.f[6]++;var emailAddress=(cov_j3dzxm5iw.s[36]++,req.body.emailAddress);var userIndex=(cov_j3dzxm5iw.s[37]++,_users.default.find(function(user){cov_j3dzxm5iw.f[7]++;cov_j3dzxm5iw.s[38]++;return user.emailAddress===emailAddress;}));cov_j3dzxm5iw.s[39]++;if(userIndex){cov_j3dzxm5iw.b[2][0]++;cov_j3dzxm5iw.s[40]++;return res.status(200).json({msg:"A mail has been forwarded to ".concat(emailAddress,". Follow the link to reset your password"),emailAddress:emailAddress});}else{cov_j3dzxm5iw.b[2][1]++;}cov_j3dzxm5iw.s[41]++;res.status(404).json({msg:"Your email address: ".concat(emailAddress," is not recognised.")});}}]);cov_j3dzxm5iw.s[42]++;return UsersCtrl;}());var _default=(cov_j3dzxm5iw.s[43]++,UsersCtrl);cov_j3dzxm5iw.s[44]++;exports.default=_default;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsiVXNlcnNDdHJsIiwicmVxIiwicmVzIiwic3RhdHVzIiwianNvbiIsIlVzZXJzRGF0YSIsImJvZHkiLCJ0aXRsZSIsImZpcnN0bmFtZSIsImxhc3RuYW1lIiwiZW1haWxBZGRyZXNzIiwicGhvbmVOdW1iZXIiLCJyb2xlIiwiZ2VuZGVyIiwicGFzc3BvcnQiLCJjb250YWN0QWRkcmVzcyIsImlkIiwibGVuZ3RoIiwic3RhZmZJZCIsImNyZWF0ZWRBdCIsIkRhdGUiLCJuZXdVc2VyIiwicHVzaCIsIm1zZyIsImRhdGEiLCJwYXNzd29yZCIsInVzZXJEZXRhaWwiLCJmaW5kIiwidXNlciIsInRva2VuIiwiand0Iiwic2lnbiIsInByb2Nlc3MiLCJlbnYiLCJTRUNSRVQiLCJleHBpcmVzSW4iLCJ1c2VySW5kZXgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFFQTs7OztJQUlNQSxTOzs7Ozs7Ozs7O0FBQ0o7Ozs7OzsrQkFNa0JDLEcsRUFBS0MsRyxFQUFLO0FBQzFCLGFBQU9BLEdBQUcsQ0FBQ0MsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCO0FBQUVDLFFBQUFBLFNBQVMsRUFBVEE7QUFBRixPQUFyQixDQUFQO0FBQ0Q7QUFFRDs7Ozs7Ozs7OytCQU1rQkosRyxFQUFLQyxHLEVBQUs7QUFBQSxzQkFXdEJELEdBQUcsQ0FBQ0ssSUFYa0I7QUFBQSxVQUV4QkMsS0FGd0IsYUFFeEJBLEtBRndCO0FBQUEsVUFHeEJDLFNBSHdCLGFBR3hCQSxTQUh3QjtBQUFBLFVBSXhCQyxRQUp3QixhQUl4QkEsUUFKd0I7QUFBQSxVQUt4QkMsWUFMd0IsYUFLeEJBLFlBTHdCO0FBQUEsVUFNeEJDLFdBTndCLGFBTXhCQSxXQU53QjtBQUFBLFVBT3hCQyxJQVB3QixhQU94QkEsSUFQd0I7QUFBQSxVQVF4QkMsTUFSd0IsYUFReEJBLE1BUndCO0FBQUEsVUFTeEJDLFFBVHdCLGFBU3hCQSxRQVR3QjtB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QUFBQSxHQUFHLGdDQUF5QmIsWUFBekI7QUFEZ0IsT0FBckI7QUFHRDs7Ozs7ZUFHWVYsUyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvYW5kZWxhL0RvY3VtZW50cy9zdG9yZS1tYW5hZ2VyL2FwcC9jb250cm9sbGVyIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xuXG5pbXBvcnQgVXNlcnNEYXRhIGZyb20gJy4uL2RhdGEvdXNlcnMnO1xuXG4vKipcbiAqIEBjbGFzcyBVc2Vyc0N0cmxcbiAqIEBjbGFzc2Rlc2MgbWFuYWdlcyBVc2Vyc1xuICovXG5jbGFzcyBVc2Vyc0N0cmwge1xuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIC0gcmV0cmlldmVzIGFsbCB1c2Vyc1xuICAgKiBAcGFyYW0geyp9IHJlcSAtIFJlcXVlc3Qgb2JqZWN0XG4gICAqIEBwYXJhbSB7Kn0gcmVzIC0gcmVzcG9uc2Ugb2JqZWN0XG4gICAqIEByZXR1cm5zIHt1c2Vyc30gcmV0dXJucyBVc2Vyc1xuICAgKi9cbiAgc3RhdGljIGdldEFsbFVzZXIocmVxLCByZXMpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBVc2Vyc0RhdGEgfSk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIENyZWF0ZSBhIG5ldyB1c2VyIGVpdGhlciBhcyBhbiBBZG1pbiBvciBhIHNhbGUgYXR0ZW5kYW50XG4gICAqIEBwYXJhbSB7Kn0gcmVxIC0gcmVxdWVzdCBvYmplY3RcbiAgICogQHBhcmFtIHsqfSByZXMgLSByZXNwb25zZSBvYmplY3RcbiAgICogQHJldHVybnMge251bGx9IC0gbm8gcmV0dXJuc1xuICAgKi9cbiAgc3RhdGljIGNyZWF0ZVVzZXIocmVxLCByZXMpIHtcbiAgICBjb25zdCB7XG4gICAgICB0aXRsZSxcbiAgICAgIGZpcnN0bmFtZSxcbiAgICAgIGxhc3RuYW1lLFxuICAgICAgZW1haWxBZGRyZXNzLFxuICAgICAgcGhvbmVOdW1iZXIsXG4gICAgICByb2xlLFxuICAgICAgZ2VuZGVyLFxuICAgICAgcGFzc3BvcnQsXG4gICAgICBjb250YWN0QWRkcmVzc1xuICAgIH0gPSByZXEuYm9keTtcbiAgICBjb25zdCBpZCA9IFVzZXJzRGF0YS5sZW5ndGggKyAxO1xuICAgIGNvbnN0IHN0YWZmSWQgPSBgU00wJHtpZH1gO1xuICAgIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgbmV3VXNlciA9IHtcbiAgICAgIGlkLFxuICAgICAgdGl0bGUsXG4gICAgICBzdGFmZklkLFxuICAgICAgZmlyc3RuYW1lLFxuICAgICAgbGFzdG5hbWUsXG4gICAgICBlbWFpbEFkZHJlc3MsXG4gICAgICBwaG9uZU51bWJlcixcbiAgICAgIHJvbGUsXG4gICAgICBnZW5kZXIsXG4gICAgICBwYXNzcG9ydCxcbiAgICAgIGNvbnRhY3RBZGRyZXNzLFxuICAgICAgY3JlYXRlZEF0XG4gICAgfTtcbiAgICBVc2Vyc0RhdGEucHVzaChuZXdVc2VyKTtcbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICBtc2c6ICdOZXcgdXNlciBzdWNjZXNzZnVsbHkgY3JlYXRlZCcsXG4gICAgICBkYXRhOiBuZXdVc2VyXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIC0gQWNjZXB0IHR3byBmaWVsZCB0byBsb2dpbiBhIHVzZXJcbiAgICogQHBhcmFtIHsqfSByZXEgLSByZXF1ZXN0IG9iamVjdFxuICAgKiBAcGFyYW0geyp9IHJlcyAtIHJlc3BvbnNlIG9iamVjdFxuICAgKiBAcmV0dXJucyB7bnVsbH0gLSBubyByZXR1cm5cbiAgICovXG4gIHN0YXRpYyB1c2VyTG9naW4ocmVxLCByZXMpIHtcbiAgICBjb25zdCB7IHN0YWZmSWQsIHBhc3N3b3JkIH0gPSByZXEuYm9keTtcbiAgICBjb25zdCB1c2VyRGV0YWlsID0gVXNlcnNEYXRhLmZpbmQodXNlciA9PiB1c2VyLnN0YWZmSWQgPT09IHN0YWZmSWQgJiYgdXNlci5wYXNzd29yZCA9PT0gcGFzc3dvcmQpO1xuICAgIGlmICh1c2VyRGV0YWlsKSB7XG4gICAgICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKHsgc3RhZmZJZDogYCR7dXNlckRldGFpbC5yb2xlfWAgfSwgcHJvY2Vzcy5lbnYuU0VDUkVULCB7IGV4cGlyZXNJbjogJzFoJyB9KTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIG1zZzogJ0xvZ2luIHN1Y2Nlc3NmdWwnLFxuICAgICAgICB0b2tlblxuICAgICAgfSk7XG4gICAgfVxuICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgIG1zZzogJ0xvZ2luIGZhaWxlZCdcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gLSBSZXNldCB1c2VyIHBhc3N3b3JkXG4gICAqIEBwYXJhbSB7Kn0gcmVxIC0gcmVxdWVzdCBvYmplY3RcbiAgICogQHBhcmFtIHsqfSByZXMgIC0gcmVzcG9uc2Ugb2JqZWN0XG4gICAqIEByZXR1cm5zIHtudWxsfSAtIE5vIHJldHVybnNcbiAgICovXG4gIHN0YXRpYyByZXNldFBhc3N3b3JkKHJlcSwgcmVzKSB7XG4gICAgY29uc3QgeyBlbWFpbEFkZHJlc3MgfSA9IHJlcS5ib2R5O1xuICAgIGNvbnN0IHVzZXJJbmRleCA9IFVzZXJzRGF0YS5maW5kKHVzZXIgPT4gdXNlci5lbWFpbEFkZHJlc3MgPT09IGVtYWlsQWRkcmVzcyk7XG4gICAgaWYgKHVzZXJJbmRleCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgbXNnOiBgQSBtYWlsIGhhcyBiZWVuIGZvcndhcmRlZCB0byAke2VtYWlsQWRkcmVzc30uIEZvbGxvdyB0aGUgbGluayB0byByZXNldCB5b3VyIHBhc3N3b3JkYCxcbiAgICAgICAgZW1haWxBZGRyZXNzXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgbXNnOiBgWW91ciBlbWFpbCBhZGRyZXNzOiAke2VtYWlsQWRkcmVzc30gaXMgbm90IHJlY29nbmlzZWQuYFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFVzZXJzQ3RybDtcbiJdfQ==